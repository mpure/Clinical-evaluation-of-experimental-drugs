/*十二导联心电图分析*/
/*运行本程序前请将CDISC数据命名为medical逻辑库，并运行分析集划分.sas*/

DATA EG_SS0;
	SET MEDICAL.EG;
	WHERE EGTEST='研究者判断' AND EPOCH^= '筛选期';
	KEEP USUBJID EGTEST EGORRES VISIT EPOCH EGSEQ;
RUN;

PROC SQL;
	CREATE TABLE EG_SS AS
	SELECT A.*,B.ACTARMCD FROM EG_SS0 A,SS B WHERE
	A.USUBJID = B.USUBJID;
QUIT;

PROC SORT DATA=MY_EG0 OUT=TEMP1;
	BY USUBJID EGTEST VISIT;
RUN;

DATA TEMP2;
	SET TEMP1;
	BY USUBJID EGTEST VISIT;
	IF FIRST.USUBJID;
RUN;

PROC TRANSPOSE DATA = TEMP2 OUT = TEMP3;
	BY USUBJID EGTEST ACTARMCD EPOCH EGSEQ ;
	ID VISIT;
	VAR EGORRES;
RUN;

PROC SQL;
	CREATE TABLE UNN0 AS
	SELECT * FROM EG_SS0 A WHERE
	A.EGORRES='异常，有临床意义' 
	AND A.EPOCH='双盲治疗期'
	AND A.USUBJID NOT IN 
		(SELECT USUBJID FROM EG_SS0 B WHERE
		A.USUBJID = B.USUBJID
		AND A.EGTEST =B.EGTEST
		AND B.EPOCH ='导入期'
		AND B.EGORRES ='异常，有临床意义');
QUIT;

DATA UNN1(KEEP=USUBJID EGORRES);
	SET UNN0;
	RESULT='出现异常';
RUN;

PROC SORT DATA=UNN1;
	BY USUBJID EGORRES;
RUN;

DATA UNN2;
	LENGTH EGORRES $100.;
	SET SS;
	EGORRES='正常';
RUN;

DATA TEMP4(DROP=VISIT EPOCH);
	UPDATE UNN2 UNN1;
	BY USUBJID;
RUN;

DATA TEMP5;
	SET TEMP4;
	IF EGORRES='异常，有临床意义' THEN EGORRES='出现异常';
RUN;

PROC TABULATE DATA=TEMP5 OUT=TEMP6(DROP=_TYPE_ _PAGE_ _TABLE_) MISSING;
	CLASS ACTARMCD EGORRES;
	TABLE ACTARMCD,EGORRES;
RUN;

PROC FREQ DATA=TEMP6;
/*卡方检验*/
	TABLE ACTARMCD*EGORRES/CHISQ CMH FISHER;
	WEIGHT N;
RUN;
